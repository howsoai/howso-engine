(seq
	#unit_test (direct_assign_to_entities (assoc unit_test (load "unit_test.amlg")))
	(call (load "unit_test_howso.amlg") (assoc name "ut_h_metrics.amlg"))

	(declare (assoc
		cases
			(list
				(list 0 0)
				(list 0 1)
                (list 1 0)
                (list 1 1)

                (list 10 10)
                (list 10 12)
                (list 11 10)
                (list 13 13)
			)
		features (list "A" "B")
	))

    (print "check initial metrics equal expected values: ")
    (call assert_same (assoc
		obs
			(get (call_entity "howso" "get_metrics") [1 "payload"])
		exp
			(assoc
				data_mass_change_since_last_analyze 0.0
			)
	))

    (call_entity "howso" "train" (assoc
        features features
        cases cases
        session "unit_test"
    ))

	(print "data mass change should increase after train: ")
	(call assert_true (assoc
		obs (< 0 (get (call_entity "howso" "get_metrics") [1 "payload" "data_mass_change_since_last_analyze"]))
	))

    (call_entity "howso" "analyze")

    (print "data mass change should reset after analyze: ")
	(call assert_true (assoc
		obs (= 0 (get (call_entity "howso" "get_metrics") [1 "payload" "data_mass_change_since_last_analyze"]))
	))

	(call exit_if_failures (assoc msg unit_test_name))
)